#!/usr/bin/python3
# SPDX-FIleCopyrightText: 2024 Ibuki Haga
# SPDX-License-Identifier: BSD-3-Clause

import math

def throwdis(v0, theta_rad, H, ground_rad):
    """
    v0         : 初速度        (m/s)
    theta_rad  : 投げる角度    (rad)
    H          : 投げる高さ    (m)
    ground_rad : 地面の傾き    (rad)  ※正なら上り坂、負なら下り坂
    """

    t = 0.0
    g = 9.806   # 重力加速度
    dt = 0.001  # 時間刻み（1ms）

    while True:
        x = v0 * math.cos(theta_rad) * t
        y = H + v0 * math.sin(theta_rad) * t - 0.5 * g * t * t

        # 斜面の高さ
        y_ground = math.tan(ground_rad) * x

        # 衝突判定
        if y < y_ground:
            print(f"到達距離          : {x:.3f} m")
            print(f"落下時間          : {t:.3f} s")

            vx = v0 * math.cos(theta_rad)
            vy = v0 * math.sin(theta_rad) - g * t
            angle_rad = math.atan2(vy, vx)
            angle_deg = math.degrees(angle_rad)

            print(f"落下時の進行角度  : {angle_deg:.3f} deg")
            return

        # 異常（落下しない）
        if t >= 60:
            print("飛翔時間が60秒を超過。計算を終了します。")
            return

        t += dt


# ---- 標準入力 ----
v0 = float(input("初速度 (m/s) を入力してください： "))

theta_deg = float(input("投げる角度 (deg) を入力してください： "))
theta_rad = math.radians(theta_deg)

H = float(input("高さ (m) を入力してください： "))
while True:
    ground_deg = float(input("地面の傾き (deg) を入力してください： "))
    if -85 <= ground_deg <= 85:
        break
    print("地面の角度は85(deg) ~ -85(deg) の範囲で入力してください。")
ground_rad = math.radians(ground_deg)

throwdis(v0, theta_rad, H, ground_rad)
